#!/usr/bin/env python3
import sys
from optparse import OptionParser

import acmd

if __name__ == '__main__':
    parser = OptionParser("acmd [options] <command> <args>")
    parser.add_option("-s", "--server", dest="server",
                      help="server name", metavar="str")

    (options, args) = parser.parse_args()
    if len(args) == 0:
        optparse.print_usage()
        sys.exit(0)
    elif len(args) == 1:
        cmd_name, args = args[0], []
    else:
        cmd_name, args = args[0], args[1:]

    server = acmd.get_server(options.server)
    print("Using server {s}".format(s=server))

    cmd = acmd.get_command(cmd_name)
    status = cmd.execute(args)
    sys.exit(status)
